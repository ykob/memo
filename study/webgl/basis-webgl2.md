# WebGL2 の基礎

## 参考書籍

- [初めてのWebGL 2 第2版](https://www.oreilly.co.jp/books/9784873119373/)
- [Example](https://github.com/PacktPublishing/Real-Time-3D-Graphics-with-WebGL-2)

## WebGLレンダリングパイプライン

WebGLは単なるラスタライゼーションエンジンに過ぎない。  
入力されたコードに従ってポイント、ライン、三角形を描画するだけ。  
それ以上のことをWebGLで実現したければ、目的とする処理を実現するコードを自分で記述する必要がある。

WebGLはマシンのGPU上で動作するため、GPU上で実行されるコードを記述しなければならない。  
コードは組となる2つの関数として与える必要がある。それらは頂点シェーダー(vertex shader)とフラグメントシェーダー(fragment shader)と呼ばれる。  

|用語|用途|
|---|---|
|頂点バッファオブジェクト (VBO)|描画対象のジオメトリを定義するデータを保持する。頂点座標、法線、色、テクスチャ座標など。|
|インデックスバッファオブジェクト (IBO)|このバッファ内の値が頂点バッファ内の各頂点のインデックスとして解釈される。|
|頂点シェーダー|各頂点に対して呼び出されるコード。頂点座標、法線、色、テクスチャ座標などの頂点ごとのデータを操作する。これらのデータは頂点シェーダ内では `attribute` として扱われる。|
|フラグメントシェーダー|描画領域のピクセルごとの色を計算する。|
|フレームバッファ|フラグメントシェーダーによって処理されたフラグメントを保持する2次元のバッファ。レンダリングパイプラインの最終出力先。|
|テクスチャ|シェーダー内からアクセスできる配列状のデータ。画像データが最も一般的だが、実際には単なる数値データで、色の配列以外の値も保持できる。|
|`attribute`|頂点シェーダで使用される入力変数。VBOからどのようにデータを取り出すかが指定されていて、それに基づいて頂点シェーダーにデータを提供する。頂点シェーダは頂点ごとに呼び出されるので、 `attribute` の値は頂点シェーダーが実行されるたびに異なる。|
|`uniform`|頂点シェーダーとフラグメントシェーダーの両方で利用できる入力変数。一度のレンダリングサイクル中に値が変わることはない。|
|`varying`|頂点シェーダーからフラグメントシェーダーにデータを受け渡すために使用する変数。|
|頂点|3Dオブジェクトの角を定義する点。x, y, z座標に対応する3つの浮動小数点数で表現される。頂点はすべてJavaScript配列で記述し、その配列を使用してWebGLの頂点バッファが構築される。|
|インデックス|WebGLに頂点をどのように接続して面を構成するかを伝える。頂点と同様、JavaScript配列で記述し、WebGLのインデックスバッファを通してレンダリングパイプラインに引き渡される。インデックス配列は一般的に三角形を反時計回りで定義する。その順序を利用して面の前後の向きを判断し、それに基づいてカリングや描画を実行することがある。|
|カリング (culling)|オブジェクトのポリゴンが表示可能かどうかを決定する。|

## WebGL2 コンテキストの取得情報

以下のようにする。

```
const gl = canvas.getContext('webgl2');
```

## API

|API名|用途|
|---|---|
|`gl.clear(mask)`|描画領域を指定した色でクリアする|
|`gl.clearColor()`|描画領域のクリアカラーを設定する|
|`gl.viewport(x, y, width, height)`|描画領域のビューポートを指定する|

## 定数

|定数名|用途|
|---|---|
|`gl.COLOR_BUFFER_BIT`|3DCGの描画領域であるカラーバッファを示す|

## 参考リンク

- [WebGLRenderingContext - Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API/WebGLRenderingContext/)

# プロジェクション座標変換

通常の3Dアプリケーションにはカメラがあるが、WebGLのAPI自体にあるのは行列だけであり、カメラオブジェクトに該当するものはない。 
WebGLでカメラを表現するためには4×4の行列を使用する必要がある。  

カメラを動かすと、それに併せてオブジェクトの表示を更新しなければならない。  
それには新しい視点に対応するように各頂点に規則的な座標変換を適用する必要がある。  
その際に重要なのが、カメラの移動後にオブジェクトの法線と光線の向きの一貫性を維持することである。つまり、頂点(位置)と法線(向き)それぞれの変換の仕方を理解する必要がある。

## 頂点変換

WebGLのシーンのオブジェクトには、スクリーン上に表示される前に様々な座標変換が適用される。  
それぞれの変換は4×4行列の形式で表現される。  
3次元ベクトルで表現される位置や向きに4×4行列を掛け合わせるには、タプルに一次元を追加して濃度を拡張すればよい。  
つまり、それぞれの頂点座標に同次座標と呼ばれる4番目の要素を追加する。

### 同次座標

同次座標を利用することで、アフィン変換（回転、拡大縮小、せん断変形、平行移動など）と4×4行列を使用した投影変換を表現できる。

同次座標系では頂点は `(x, y, z, w)` という4つの要素を持つ。  
最初の3つはユークリッド空間での頂点座標で、4番目が投影養素となる。  
4要素のタプル `(x, y, z, w)` を使用することで投影空間を定義することが出来る。

同次座標は各座標を `w` で割ることで非同次座標（旧来のユークリッド座標）に簡単に変換できる。  
逆にユークリッド空間から投影空間に変換するには `w` に1を追加すればよい。  
また `w` が `0` の同次座標は無限遠の点を表す。

頂点シェーダーにおいて、位置ベクトルの変換で頻繁に用いられる記述は以下のようになる。

```
vec4 mvPosition = ModelViewMatrix * vec4(position, 1.0);
```

### モデル変換

空間上でオブジェクトを変形させたり移動させたい場合、モデル行列を用いてオブジェクト座標をワールド座標に変換すればよい。  
頂点のオブジェクト座標にモデル行列をかけ合わせて得られる頂点座標が3D空間でのオブジェクトの位置になる。  

オブジェクト座標系では、各オブジェクトごとに定義された原点を元に、各頂点が原点からどの位置にあるのかを指定する。
ワールド座標系では、原点はすべてのオブジェクトで共通であり、オブジェクト同士がお互いにどのような位置関係にあるのかを知ることができる。
ワールド座標系でオブジェクトがどこにあるのかを指定することを**モデル変換**という。

### ビュー変換

ワールド座標系をビュー座標系に変換することを**ビュー変換**という。  
ビュー変換では座標系の原点をビューの原点（カメラ位置）に移動する。  
ビュー行列をモデル変換で得られた頂点座標に掛け合わせることで、ビューの原点をを基準とした新しい頂点座標を得ることができる。  
カメラの操作はこの座標系内で行う。

## 透視投影 (Perspective Projection)

## 平行投影 (Parallel Projection)
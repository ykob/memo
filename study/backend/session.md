# セッション管理

## セッション管理の設計パターン

- Client Session State (クライアントセッション)
- Server Session State (サーバーセッション)
- Database Session State (データベースセッション)

### Client Session State

クライアント側でセッション情報を保持するパターン。  
CookieやLocalStorageのほか、URLクエリパラメータ、`input[type="hidden"]`要素を使ってセッション情報を保持する。  

CookieやLocalStorageを用いたパターンはブラウザを閉じてもユーザー情報を維持することができるメリットがある。  
Cookieを利用する場合はSecure属性を付与して漏洩リスクを軽減することができる。  
Cookieの容量は4KBまでなので、複雑なセッション情報を保持したい場合は注意が必要となる。  
またCookieはJavaScriptなどからも書き換えが容易にできてしまうので、サーバから指定された情報が改ざんされるリスクがある。

クエリパラメータやinputタグを用いたパターンはCookieが利用できない環境下でも有効だが、ブラウザにセッション情報を保持できないデメリットがある。  
また同パターンにおいても、クライアント・サーバ間でセッション情報をやり取りする際に改ざんされるリスクがある。

Client Session Stateは常にセキュリティリスクを抱えているという前提のもとに運用する必要がある。

### Server Session State

アプリケーションサーバー側でセッション情報を保持するパターン。  
このパターンにおいてクライアント側が持つ情報は、サーバー側が持つセッション情報を特定するためのIDのみになる。  
クライアントからのリクエストではセッションIDのみを送信し、サーバー側ではセッションIDをキーにしてセッション情報を取得し返却する。  

この場合、アプリケーションサーバーを再起動するとセッション状態もリセットされてしまう。

### Database Session State

データベース側でセッション情報を保持するパターン。  
Server Session Stateと同様、クライアント側が持つ情報はセッションIDのみになる。
データベースにはセッション情報をシリアライズして格納する。格納されたデータは、オブジェクトとして再現することができる。

この場合、アプリケーションサーバーを再起動してもセッション情報は保持されるが、セッション状態をデータベースからクリーンアップする仕組みが必要になる。

## 参考リンク

- [Webアプリケーションのセッション管理](https://fintan.jp/wp-content/uploads/2021/12/eafb1d61d2382a450ded5d97a4a2c464.pdf)